

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3. Filtering &mdash; Shalek Lab HowTos  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="4. Doublets" href="doublets.html" />
    <link rel="prev" title="2. Dropout?" href="dropout.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #F9F9F9" >
          

          
            <a href="index.html">
          

          
            
            <img src="_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="home.html">Welcome to the HowTos wiki!</a></li>
</ul>
<p class="caption"><span class="caption-text">Terra</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="how_to_for_new_terra_users.html">How to for new Terra Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="how_do_i_use_terra_pipelines.html">How do I use Terra Pipelines?</a></li>
<li class="toctree-l1"><a class="reference internal" href="how_do_i_use_terra_notebooks.html">How do I use Terra Notebooks?</a></li>
<li class="toctree-l1"><a class="reference internal" href="drop_seq_tools_on_terra.html">Drop Seq Tools on Terra</a></li>
<li class="toctree-l1"><a class="reference internal" href="drop_seq_tools_on_terra.html#output-files">Output files:</a></li>
<li class="toctree-l1"><a class="reference internal" href="drop_seq_tools_on_terra.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="seqwell_demultiplexing_on_terra.html">SeqWell Demultiplexing on Terra</a></li>
<li class="toctree-l1"><a class="reference internal" href="kallisto_bustools_on_terra.html">Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="kallisto_bustools_on_terra.html#notebook">Notebook</a></li>
</ul>
<p class="caption"><span class="caption-text">Data Analysis</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="reading_in_the_data_to_r.html">1. Reading in the data (to R)</a></li>
<li class="toctree-l1"><a class="reference internal" href="dropout.html">2. Dropout?</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">3. Filtering</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#why-threshold">3.1. Why threshold</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-to-threshold-on">3.2. What to threshold on</a></li>
<li class="toctree-l2"><a class="reference internal" href="#examples-of-bad-thresholding-removing-biological-variation">3.3. Examples of bad thresholding (removing biological variation):</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="doublets.html">4. Doublets</a></li>
<li class="toctree-l1"><a class="reference internal" href="normalization.html">5. Normalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="choosing_variable_genes.html">6. Choosing variable genes</a></li>
<li class="toctree-l1"><a class="reference internal" href="pca.html">7. PCA</a></li>
<li class="toctree-l1"><a class="reference internal" href="other_dimensionality_reduction.html">8. Other dimensionality reduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="batch_correction.html">9. Batch Correction</a></li>
<li class="toctree-l1"><a class="reference internal" href="imputation.html">10. Imputation</a></li>
<li class="toctree-l1"><a class="reference internal" href="clustering.html">11. Clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="clustering.html#how-do-i-know-i-have-a-good-clustering">12. How do I know I have a good clustering?</a></li>
<li class="toctree-l1"><a class="reference internal" href="clustering.html#what-if-i-am-looking-for-rare-cell-subsets">13. What if I am looking for rare cell subsets?</a></li>
<li class="toctree-l1"><a class="reference internal" href="clustering.html#what-if-some-cells-are-clearly-placed-in-the-wrong-clusters">14. What if some cells are clearly placed in the wrong clusters?</a></li>
<li class="toctree-l1"><a class="reference internal" href="differential_expression.html">15. Differential Expression</a></li>
<li class="toctree-l1"><a class="reference internal" href="cell_ordering_pseudotime.html">16. Cell Ordering (“Pseudotime”)</a></li>
<li class="toctree-l1"><a class="reference internal" href="network_inference.html">17. Network Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="i_have_a_bunch_of_genes__now_what.html">18. I have a bunch of genes  now what?</a></li>
<li class="toctree-l1"><a class="reference internal" href="meta_analysis.html">19. Meta analysis</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Shalek Lab HowTos</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>3. Filtering</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/filtering.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="filtering">
<h1>3. Filtering<a class="headerlink" href="#filtering" title="Permalink to this headline">¶</a></h1>
<div class="section" id="why-threshold">
<h2>3.1. Why threshold<a class="headerlink" href="#why-threshold" title="Permalink to this headline">¶</a></h2>
<p>Some cells are crappy- maybe they just didn’t get too many reads, maybe they only got reads for a few genes.</p>
<p>Some genes are just not expressed that highly in your cells. High dimensional data is slower to deal with, and keeping genes that are only expressed in a few cells adds noise to the data. Because of this you should always remove genes that are expressed in no cells at all. People almost always remove genes that are expressed in very few cells (I can’t think of a time when they leave these genes in, but I’m sure someone has done it). This is because these genes provide little information about the data. Genes that are lowly expressed are often not detected, but, as described above, it is difficult to differentiate if these genes are not expressed or just expressed below detectable rates. Someone in the lab (can’t remember who) said to me that they find it hard to believe that a single (or small amount of) transcript of a gene in a cell could ever be enough to really influence cell state. Even if these low counts are representative of real information, they likely have little influence on the phenotype you are trying to observe.</p>
<p>When thresholding, remember to take into account the biology of the system:</p>
<ul class="simple">
<li><p>Highly heterogeneous group of cells - more genes will be involved in describing the variation in downstream analysis</p></li>
<li><p>Mostly one cell type - fewer genes will be needed in total</p></li>
<li><p>Large cells will have more RNA, so you should expect more UMIs or read counts to come from those cells than from smaller cells</p></li>
<li><p>Activated/stimulated cells will be expressing more RNA as well as a higher diversity of genes - a more complex library</p></li>
<li><p>If you expect to have some rare cell populations in your data set, be more conservative in gene filtering especially if you are filtering genes out that are expressed in a low fraction of cells.</p></li>
</ul>
</div>
<div class="section" id="what-to-threshold-on">
<h2>3.2. What to threshold on<a class="headerlink" href="#what-to-threshold-on" title="Permalink to this headline">¶</a></h2>
<p>I always threshold cells first then threshold on genes in the remaining cells. This is because if some genes only exist in cells that I consider low quality, I want to remove those genes from my analysis as well. You could say the same in the opposite direction, but because my approaches to cell filtering take into account metadata that is not just number of genes/transcripts while gene filtering only takes into account expression of that gene, I think that filtering on cells first is most useful.</p>
<p>For filtering out low quality cells:</p>
<p>Number of genes, number of UMIs (seq-well) or transcripts (SS2/bulk), %ribosomal RNA, %mitochondrial RNA, % transcriptome mapping, % genome mapping are all parameters you could threshold on.</p>
<p>Second strand synthesis in Seq-Well increases the expected number of genes to ~1000, so your thresholds for these cells should be higher than other technologies.</p>
<p>In SS2 you expect 1000-2000 genes per cell depending on the cell type. Some cells express much fewer genes (because they are small or just not doing much). If your cells are actively dividing, recently stimulated with something, or really big, you expect there to be more different genes. If they are pretty small and are unstimulated you might see fewer genes.</p>
<p>In the Seurat tutorial, they threshold on 200 genes (for 10x data).</p>
<p>Thresholding on % transcriptome mapping and % genome mapping is a way to take into account more technical differences in the quality of that cell’s library. If the percent of genome mapping is much larger than the transcriptome, it is possible that you have mostly genomic reads (and since genomic reads are a superset of transcriptome reads, the transcriptome reads may just be bits of genomic reads that happened to be on transcribed regions). The genome you choose to align to as well as the aligner greatly alter these values, so you need to choose them for each individual dataset. (looking at a histogram of the distributions of these metadata is helpful - just remember to increase the number of bins &gt;10 which is often the default!)</p>
</div>
<div class="section" id="examples-of-bad-thresholding-removing-biological-variation">
<h2>3.3. Examples of bad thresholding (removing biological variation):<a class="headerlink" href="#examples-of-bad-thresholding-removing-biological-variation" title="Permalink to this headline">¶</a></h2>
<p>Cells are different sizes and produce different amounts of RNA. You can’t use the same gene count threshold for all cell types, and you need to check that you are not cutting out an entire cell type when you threshold your cells. This can be especially problematic with very rare populations.</p>
<p>In situations where you may have multiple samples/arrays for a single project, it may make sense to do you cell/gene filtering twice - on the individual samples if you are doing any analysis on just that data, as well as on the combined raw data from all samples. This is because (and this is exemplified in atlas-style projects like Carly’s monkeys) sometimes a rare cell type has very few cells in each individual sample, but when the samples are combined, it is clear that this cell type is not just noise. If each sample was filtered before combining, you would have lost this cell type.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="doublets.html" class="btn btn-neutral float-right" title="4. Doublets" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="dropout.html" class="btn btn-neutral float-left" title="2. Dropout?" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Shalek Lab

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>